<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="https://www.sevenmentor.com/assets/adaptive_lms-Bjwky3P8.webp" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual: Proyecto Gesti√≥n de Biblioteca üìö</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" integrity="sha512-mIs9kKbaw6JZFfSuo+MovjU+Ntggfoj8RwAmJbVXQ5mkAX5LlgETQEweFPI18humSPHymTb5iikEOKWF7I8ncQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" integrity="sha512-cbQXwDFK7lj2Fqfkuxbo5iD1dSbLlJGXGpfTDqbggqjKMGXJfBjsGN0BFD7NHMsvkchVf7rWdNmcW/VPrmljew==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">
            <h4><i class="fas fa-book-reader"></i> Manual del Proyecto</h4>
        </div>
        <nav class="nav flex-column">
            <a class="nav-link active" href="#introduccion"><i class="fas fa-info-circle"></i> Introducci√≥n</a>
            <a class="nav-link" href="#tecnologias"><i class="fas fa-cogs"></i> Tecnolog√≠as</a>
            <a class="nav-link" href="#importancia"><i class="fas fa-lightbulb"></i> Importancia</a>
            <a class="nav-link" href="#fundamentos"><i class="fas fa-layer-group"></i> Fundamentos vs Frameworks</a>
            <a class="nav-link" href="#parte1"><i class="fas fa-database"></i> Parte 1: Base de Datos</a>
            <a class="nav-link" href="#parte2"><i class="fas fa-server"></i> Parte 2: Backend</a>
            <a class="nav-link" href="#paso2-1"><i class="fas fa-terminal"></i> 2.1 Init y Dependencias</a>
            <a class="nav-link" href="#paso2-2"><i class="fas fa-file-alt"></i> 2.2 Archivo .env</a>
            <a class="nav-link" href="#paso2-3"><i class="fas fa-cogs"></i> 2.3 Config BD (db.js)</a>
            <a class="nav-link" href="#paso2-4"><i class="fas fa-code"></i> 2.4 Server.js</a>
            <a class="nav-link" href="#paso2-5"><i class="fab fa-npm"></i> 2.5 Scripts package.json</a>
            <a class="nav-link" href="#parte3"><i class="fas fa-desktop"></i> Parte 3: Frontend</a>
            <a class="nav-link" href="#paso3-1"><i class="fab fa-html5"></i> 3.1 HTML (index.html)</a>
            <a class="nav-link" href="#paso3-2"><i class="fab fa-css3-alt"></i> 3.2 CSS (style.css)</a>
            <a class="nav-link" href="#paso3-3"><i class="fab fa-js-square"></i> 3.3 JavaScript (main.js)</a>
            <a class="nav-link" href="#parte4"><i class="fas fa-play-circle"></i> Parte 4: Ejecuci√≥n</a>
            <a class="nav-link" href="#conclusion"><i class="fas fa-check-circle"></i> Conclusi√≥n</a>
        </nav>
    </div>

    <div class="main-content">
<header class="main-header">
    <div class="header-content-wrapper">
        <h1><i class="fas fa-book-open"></i> Manual del Proyecto: Gesti√≥n de Biblioteca con Node.js y SQL Server</h1>
        <img src="https://avatars.githubusercontent.com/u/38921558?v=4" alt="Avatar de Usuario" class="header-avatar">
    </div>
</header>

        <section id="introduccion" class="manual-section">
            <h2><i class="fas fa-info-circle"></i> 1. Introducci√≥n al Proyecto üöÄ</h2>
            <p>Bienvenido al manual del proyecto "Gesti√≥n de Biblioteca". Esta gu√≠a detallada te llevar√° paso a paso a trav√©s de la creaci√≥n de una aplicaci√≥n web <span class="highlight">Full-Stack</span>, desde la configuraci√≥n de la base de datos hasta la implementaci√≥n del frontend interactivo. El objetivo es construir un sistema <abbr title="Create, Read, Update, Delete">CRUD</abbr> completo para administrar libros y sus categor√≠as.</p>
            <p>Aprender√°s a integrar un backend robusto con <strong class="highlight">Node.js</strong> y <strong class="highlight">Express.js</strong>, conect√°ndote a una base de datos <strong class="highlight">SQL Server</strong> mediante el driver <code>mssql</code>. El frontend se desarrollar√° con <strong class="highlight">HTML</strong>, <strong class="highlight">CSS</strong> (y <strong class="highlight">Bootstrap</strong> para agilizar el dise√±o) y <strong class="highlight">JavaScript</strong> vainilla para la l√≥gica y la interactividad.</p>
            <p>Este proyecto es ideal para afianzar conceptos fundamentales de desarrollo web y entender c√≥mo las diferentes partes de una aplicaci√≥n se comunican entre s√≠. ¬°Empecemos! üéâ</p>
        </section>

        <section id="tecnologias" class="manual-section">
            <h2><i class="fas fa-cogs"></i> 2. Tecnolog√≠as Utilizadas üõ†Ô∏è</h2>
            <ul class="list-group">
                <li class="list-group-item"><strong>Backend:</strong>
                    <ul>
                        <li><i class="fab fa-node-js"></i> Node.js: Entorno de ejecuci√≥n para JavaScript del lado del servidor.</li>
                        <li><i class="fas fa-feather-alt"></i> Express.js: Framework minimalista y flexible para Node.js, ideal para construir APIs.</li>
                        <li><i class="fas fa-database"></i> MSSQL (Driver): Paquete <code>mssql</code> para la conexi√≥n y operaciones con SQL Server.</li>
                        <li><i class="fas fa-key"></i> DotEnv: M√≥dulo para cargar variables de entorno desde un archivo <code>.env</code>.</li>
                        <li><i class="fas fa-exchange-alt"></i> CORS: Middleware para habilitar Cross-Origin Resource Sharing.</li>
                    </ul>
                </li>
                <li class="list-group-item"><strong>Base de Datos:</strong>
                    <ul>
                        <li><i class="fas fa-server"></i> Microsoft SQL Server: Sistema de gesti√≥n de bases de datos relacional.</li>
                    </ul>
                </li>
                <li class="list-group-item"><strong>Frontend:</strong>
                    <ul>
                        <li><i class="fab fa-html5"></i> HTML5: Lenguaje de marcado est√°ndar para crear p√°ginas web.</li>
                        <li><i class="fab fa-css3-alt"></i> CSS3: Lenguaje de hojas de estilo para dise√±ar la presentaci√≥n.</li>
                        <li><i class="fab fa-bootstrap"></i> Bootstrap 5: Framework CSS popular para dise√±o responsivo y componentes predefinidos.</li>
                        <li><i class="fab fa-js-square"></i> JavaScript (Vanilla): Para la interactividad del cliente y la comunicaci√≥n con la API.</li>
                        <li><i class="fas fa-icons"></i> Font Awesome: Librer√≠a de iconos vectoriales.</li>
                    </ul>
                </li>
                <li class="list-group-item"><strong>Herramientas de Desarrollo:</strong>
                    <ul>
                        <li><i class="fas fa-terminal"></i> Nodemon (Opcional): Herramienta que reinicia autom√°ticamente el servidor Node.js durante el desarrollo.</li>
                        <li><i class="fab fa-npm"></i> NPM (Node Package Manager): Gestor de paquetes para Node.js.</li>
                        <li><i class="fas fa-tools"></i> SQL Server Management Studio (SSMS): Herramienta para administrar SQL Server.</li>
                    </ul>
                </li>
            </ul>
        </section>

        <section id="importancia" class="manual-section">
            <h2><i class="fas fa-lightbulb"></i> 3. ¬øPor qu√© son Fundamentales estos Proyectos? ü§î</h2>
            <p>Realizar proyectos <span class="highlight">Full-Stack</span> como este, que involucran la creaci√≥n de un backend, una base de datos y un frontend desde cero (o con herramientas de bajo nivel), es crucial por varias razones:</p>
            <ul>
                <li>‚ú® <strong>Comprensi√≥n Profunda:</strong> Permite entender cada capa de una aplicaci√≥n web y c√≥mo interact√∫an, en lugar de depender de la "magia" de frameworks m√°s grandes.</li>
                <li>üí™ <strong>Bases S√≥lidas:</strong> Fortalece el conocimiento de los lenguajes y tecnolog√≠as base (JavaScript, SQL, HTTP), lo cual es transferible a cualquier framework o herramienta futura.</li>
                <li>üîß <strong>Habilidades de Resoluci√≥n de Problemas:</strong> Enfrentarse a la configuraci√≥n de la base de datos, la l√≥gica de la API y la manipulaci√≥n del DOM en el cliente desarrolla habilidades cr√≠ticas de depuraci√≥n y soluci√≥n de problemas.</li>
                <li>üß© <strong>Visi√≥n Integral del Flujo de Datos:</strong> Desde la petici√≥n del usuario en el navegador hasta la consulta en la base de datos y el retorno de la respuesta, se obtiene una visi√≥n completa del ciclo de vida de una solicitud.</li>
                <li>üöÄ <strong>Preparaci√≥n para Frameworks Avanzados:</strong> Entender los fundamentos facilita enormemente el aprendizaje y el uso efectivo de frameworks m√°s complejos como Angular, React, Vue.js en el frontend, o NestJS, Spring Boot en el backend, ya que se comprende qu√© problemas est√°n resolviendo y c√≥mo lo hacen internamente.</li>
            </ul>
        </section>

        <section id="fundamentos" class="manual-section">
            <h2><i class="fas fa-layer-group"></i> 4. Fundamentos vs. Frameworks üÜö</h2>
            <p>Es com√∫n preguntarse cu√°ndo usar tecnolog√≠as fundamentales ("vanilla") y cu√°ndo optar por un framework. Ambos tienen su lugar:</p>
            <p><strong>Tecnolog√≠as Fundamentales (Vanilla JS, Node.js puro, SQL directo):</strong></p>
            <ul>
                <li><strong>Ventajas:</strong> Mayor control, menor sobrecarga (overhead), excelente para aprender los conceptos subyacentes, flexibilidad total.</li>
                <li><strong>Desventajas:</strong> Desarrollo m√°s lento para funcionalidades complejas, se debe escribir m√°s c√≥digo repetitivo (boilerplate), la gesti√≥n de estado y la estructura pueden volverse complejas en aplicaciones grandes.</li>
                <li><strong>Ideal para:</strong> Proyectos peque√±os, aprendizaje, componentes muy espec√≠ficos donde el rendimiento y el control son cr√≠ticos, o cuando se quiere construir una soluci√≥n muy personalizada.</li>
            </ul>
            <p><strong>Frameworks (Express.js, React, Angular, etc.):</strong></p>
            <ul>
                <li><strong>Ventajas:</strong> Desarrollo m√°s r√°pido, proporcionan estructura y convenciones, manejan mucho boilerplate, comunidades grandes y ecosistemas de herramientas, soluciones probadas para problemas comunes (routing, gesti√≥n de estado, ORMs).</li>
                <li><strong>Desventajas:</strong> Curva de aprendizaje, pueden ser restrictivos ("opinados"), mayor overhead, a veces es m√°s dif√≠cil entender lo que sucede "bajo el cap√≥".</li>
                <li><strong>Ideal para:</strong> Proyectos medianos a grandes, desarrollo en equipo, cuando la velocidad de desarrollo es prioritaria, y para aprovechar ecosistemas maduros.</li>
            </ul>
            <p class="highlight">En este proyecto, usamos una mezcla: <strong class="highlight">Express.js</strong> es un framework minimalista para Node.js que nos ayuda con el routing y middleware, pero interactuamos con la base de datos de forma m√°s directa con el driver <code>mssql</code> y construimos el frontend con JavaScript "vanilla". Esto ofrece un buen balance entre aprendizaje fundamental y eficiencia.</p>
        </section>

        <section id="parte1" class="manual-section">
            <h2><i class="fas fa-database"></i> Parte 1: Preparaci√≥n y Base de Datos</h2>
            <p>El primer paso es configurar nuestro entorno y la base de datos que almacenar√° la informaci√≥n de nuestra biblioteca.</p>
            
            <h3>Paso 1.1: Estructura de Carpetas del Proyecto</h3>
            <p>Una buena organizaci√≥n es clave. Crearemos la siguiente estructura:</p>
            <pre><code class="language-bash">
mi-biblioteca-2025/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ db.js
‚îÇ   ‚îú‚îÄ‚îÄ .env
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ server.js
‚îî‚îÄ‚îÄ frontend/
    ‚îú‚îÄ‚îÄ css/
    ‚îÇ   ‚îî‚îÄ‚îÄ style.css
    ‚îú‚îÄ‚îÄ js/
    ‚îÇ   ‚îî‚îÄ‚îÄ main.js
    ‚îî‚îÄ‚îÄ index.html
            </code></pre>

            <h3>Paso 1.2: Script SQL para la Base de Datos</h3>
            <p>Usaremos SQL Server. El siguiente script crea la base de datos <code>BibliotecaDB_2025</code>, las tablas <code>Categoria</code> y <code>Libro</code>, y a√±ade datos de ejemplo. Ejec√∫talo en SSMS:</p>
            <pre class="line-numbers"><code class="language-sql">
-- (Aqu√≠ va el script SQL completo que te proporcion√© para crear BibliotecaDB_2025, Categoria, Libro e insertar datos)
-- 1. Crear la Base de Datos (si no existe)
IF NOT EXISTS (SELECT * FROM sys.databases WHERE name = 'BibliotecaDB_2025')
BEGIN
    CREATE DATABASE BibliotecaDB_2025;
END
GO

-- 2. Usar la Base de Datos creada
USE BibliotecaDB_2025;
GO

-- 3. Borrar tablas si existen (para una ejecuci√≥n limpia desde cero)
IF OBJECT_ID('dbo.Libro', 'U') IS NOT NULL DROP TABLE dbo.Libro;
IF OBJECT_ID('dbo.Categoria', 'U') IS NOT NULL DROP TABLE dbo.Categoria;
GO

-- 4. Crear tabla Categoria
CREATE TABLE Categoria (
    IdCategoria INT PRIMARY KEY IDENTITY(1,1),
    Nombre VARCHAR(100) NOT NULL UNIQUE
);
GO
PRINT 'Tabla Categoria creada en BibliotecaDB_2025.';

-- 5. Crear tabla Libro
CREATE TABLE Libro (
    IdLibro INT PRIMARY KEY IDENTITY(1,1),
    Titulo VARCHAR(255) NOT NULL,
    Autor VARCHAR(150),
    FechaPublicacion DATE,
    IdCategoria INT,
    ImagenURL VARCHAR(500),
    CONSTRAINT FK_Libro_Categoria FOREIGN KEY (IdCategoria) REFERENCES Categoria(IdCategoria)
);
GO
PRINT 'Tabla Libro creada en BibliotecaDB_2025.';

-- 6. Insertar Categor√≠as
INSERT INTO Categoria (Nombre) VALUES
('Ciencia Ficci√≥n üìö'),
('Fantas√≠a ‚ú®'),
('Novela Hist√≥rica üìú'),
('Misterio y Suspense üïµÔ∏è'),
('Desarrollo Personal üå±');
GO
PRINT 'Datos de ejemplo insertados en Categoria (BibliotecaDB_2025).';

-- 7. Insertar Libros
INSERT INTO Libro (Titulo, Autor, FechaPublicacion, IdCategoria, ImagenURL) VALUES
('Dune', 'Frank Herbert', '1965-08-01', (SELECT IdCategoria FROM Categoria WHERE Nombre = 'Ciencia Ficci√≥n üìö'), 'https://m.media-amazon.com/images/I/81ym3QUd3KL._AC_UF1000,1000_QL80_.jpg'),
('El Nombre del Viento', 'Patrick Rothfuss', '2007-03-27', (SELECT IdCategoria FROM Categoria WHERE Nombre = 'Fantas√≠a ‚ú®'), 'https://proassetspdlcom.cdnstatics2.com/usuaris/libres/fotos/1894/original/portada_el-nombre-del-viento-ilustrado_patrick-rothfuss_201909191609.jpg'),
('Los Pilares de la Tierra', 'Ken Follett', '1989-01-01', (SELECT IdCategoria FROM Categoria WHERE Nombre = 'Novela Hist√≥rica üìú'), 'https://pictures.abebooks.com/isbn/9788401328510-es.jpg'),
('El C√≥digo Da Vinci', 'Dan Brown', '2003-03-18', (SELECT IdCategoria FROM Categoria WHERE Nombre = 'Misterio y Suspense üïµÔ∏è'), 'https://m.media-amazon.com/images/I/710GvzOM92L._AC_UF1000,1000_QL80_.jpg'),
('H√°bitos At√≥micos', 'James Clear', '2018-10-16', (SELECT IdCategoria FROM Categoria WHERE Nombre = 'Desarrollo Personal üå±'), 'https://m.media-amazon.com/images/I/81GiallP6CL._AC_UF1000,1000_QL80_.jpg'),
('Fundaci√≥n', 'Isaac Asimov', '1951-06-01', (SELECT IdCategoria FROM Categoria WHERE Nombre = 'Ciencia Ficci√≥n üìö'), 'https://m.media-amazon.com/images/I/71L8hprp4VL._AC_UF1000,1000_QL80_.jpg'),
('Juego de Tronos', 'George R.R. Martin', '1996-08-06', (SELECT IdCategoria FROM Categoria WHERE Nombre = 'Fantas√≠a ‚ú®'), 'https://proassetspdlcom.cdnstatics2.com/usuaris/libres/fotos/original/portada_juego-de-tronos-cancion-de-hielo-y-fuego-1_george-r-r-martin_201205031205.jpg'),
('El M√©dico', 'Noah Gordon', '1986-01-01', (SELECT IdCategoria FROM Categoria WHERE Nombre = 'Novela Hist√≥rica üìú'), 'https://www.rocalibros.com/archivos/imagenes/grandes/9788417821908-el-medico.jpg'),
('La Chica del Tren', 'Paula Hawkins', '2015-01-13', (SELECT IdCategoria FROM Categoria WHERE Nombre = 'Misterio y Suspense üïµÔ∏è'), 'https://www.planetadelibros.com/usuaris/libros/fotos/185/m_libros/184595_portada_la-chica-del-tren_paula-hawkins_201506041205.jpg'),
('El Poder del Ahora', 'Eckhart Tolle', '1997-01-01', (SELECT IdCategoria FROM Categoria WHERE Nombre = 'Desarrollo Personal üå±'), 'https://m.media-amazon.com/images/I/712oglD8NFL._AC_UF1000,1000_QL80_.jpg');
GO
PRINT 'Datos de ejemplo insertados en Libro (BibliotecaDB_2025).';

-- 8. Verificar datos (opcional)
SELECT * FROM Categoria;
SELECT * FROM Libro;
GO
PRINT 'Configuraci√≥n de base de datos BibliotecaDB_2025 completada.';
            </code></pre>
            <p class="note"><i class="fas fa-exclamation-triangle"></i> Aseg√∫rate de que el script se ejecute sin errores y que la base de datos <code>BibliotecaDB_2025</code> contenga las tablas y los datos.</p>
        </section>

        <section id="parte2" class="manual-section">
            <h2><i class="fas fa-server"></i> Parte 2: Configurar el Backend</h2>
            <p>Ahora construiremos el servidor con Node.js y Express.js.</p>

            <h3 id="paso2-1"><i class="fas fa-terminal"></i> Paso 2.1: Inicializar Node.js e Instalar Dependencias</h3>
            <p>Navega a la carpeta <code>backend</code> en tu terminal:</p>
            <pre class="line-numbers"><code class="language-bash">
cd ruta/a/tu/proyecto/mi-biblioteca-2025/backend
npm init -y
npm install express mssql dotenv cors
npm install -D nodemon
            </code></pre>

            <h3 id="paso2-2"><i class="fas fa-file-alt"></i> Paso 2.2: Archivo de Variables de Entorno (<code>.env</code>)</h3>
            <p>Crea <code>backend/.env</code> con tus credenciales:</p>
            <pre class="line-numbers"><code class="language-batch">
# backend/.env
DB_SERVER=DESKTOP-M6PHA8P\\SQLEXPRESS
DB_USER=JUANCITO
DB_PASSWORD=123456
DB_DATABASE=BibliotecaDB_2025
DB_PORT=1433
DB_ENCRYPT=false
DB_TRUST_SERVER_CERTIFICATE=true

PORT=3000
            </code></pre>
            <p class="note"><i class="fas fa-key"></i> ¬°Ajusta <code>DB_SERVER</code>, <code>DB_USER</code> y <code>DB_PASSWORD</code> a tu configuraci√≥n!</p>

            <h3 id="paso2-3"><i class="fas fa-cogs"></i> Paso 2.3: Configuraci√≥n de Base de Datos (<code>backend/config/db.js</code>)</h3>
            <pre class="line-numbers"><code class="language-javascript">
// backend/config/db.js
const sql = require('mssql');
require('dotenv').config(); // Para cargar variables de .env

const dbConfig = {
    user: process.env.DB_USER,
    password: process.env.DB_PASSWORD,
    server: process.env.DB_SERVER,
    database: process.env.DB_DATABASE,
    port: parseInt(process.env.DB_PORT || "1433"), // Aseg√∫rate de que sea un n√∫mero
    options: {
        encrypt: process.env.DB_ENCRYPT === 'true', // el driver espera un booleano
        trustServerCertificate: process.env.DB_TRUST_SERVER_CERTIFICATE === 'true' // el driver espera un booleano
    }
};

let pool; // Variable para almacenar el pool de conexiones

const connectDB = async () => {
    if (pool) return pool; // Si ya existe un pool, retornarlo
    try {
        pool = await sql.connect(dbConfig);
        console.log('‚úÖ Conectado a SQL Server');
        return pool;
    } catch (err) {
        console.error('‚ùå Error al conectar con SQL Server:', err.message);
        // Si hay un error de conexi√≥n, puedes intentar reconectar o lanzar el error
        // Por simplicidad, aqu√≠ solo lanzamos el error
        // En una aplicaci√≥n de producci√≥n, podr√≠as querer un manejo m√°s robusto (ej. reintentos)
        throw err; 
    }
};

// Funci√≥n para asegurar que el pool est√° conectado antes de usarlo
const getPool = async () => {
    if (!pool || !pool.connected) {
        console.log('üîÑ Reconectando a la base de datos...');
        pool = await connectDB();
    }
    return pool;
};


// Exportar la funci√≥n para obtener el pool y el objeto sql
module.exports = {
    sql,
    getPool,
    connectDB // Tambi√©n puedes exportar connectDB si quieres inicializarlo expl√≠citamente al inicio
};
            </code></pre>

            <h3 id="paso2-4"><i class="fas fa-code"></i> Paso 2.4: Servidor Principal (<code>backend/server.js</code>)</h3>
            <p>Este archivo contendr√° la l√≥gica de tu API.</p>
            <pre class="line-numbers"><code class="language-javascript">
// backend/server.js
const express = require('express');
const cors = require('cors');
require('dotenv').config();
const { sql, getPool, connectDB } = require('./config/db'); // Importar desde db.js

const app = express();
const PORT = process.env.PORT || 3000;

app.use(cors());
app.use(express.json());

app.get('/', (req, res) => {
    res.send('&lt;h1&gt;üìö API de Biblioteca Funcionando&lt;/h1&gt;&lt;p&gt;Accede al frontend para interactuar con la aplicaci√≥n.&lt;/p&gt;');
});

// --- Endpoints para Categor√≠as ---
app.get('/api/categorias', async (req, res) => {
    try {
        const pool = await getPool();
        const result = await pool.request().query('SELECT IdCategoria, Nombre FROM Categoria ORDER BY Nombre');
        res.json(result.recordset);
    } catch (error) {
        console.error("Error fetching categorias:", error);
        res.status(500).json({ error: 'Error al obtener las categor√≠as', details: error.message });
    }
});

// --- Endpoints para Libros (CRUD) ---

// CREATE (Guardar) un nuevo libro
app.post('/api/libros', async (req, res) => {
    const { Titulo, Autor, FechaPublicacion, IdCategoria, ImagenURL } = req.body;
    try {
        const pool = await getPool();
        const request = pool.request();
        
        request.input('Titulo', sql.VarChar, Titulo);
        request.input('Autor', sql.VarChar, Autor || null);
        request.input('FechaPublicacion', sql.Date, FechaPublicacion ? new Date(FechaPublicacion) : null);
        request.input('IdCategoria', sql.Int, IdCategoria ? parseInt(IdCategoria) : null);
        request.input('ImagenURL', sql.VarChar, ImagenURL || null);

        const query = `
            INSERT INTO Libro (Titulo, Autor, FechaPublicacion, IdCategoria, ImagenURL)
            OUTPUT INSERTED.IdLibro, INSERTED.Titulo, INSERTED.Autor, INSERTED.FechaPublicacion, INSERTED.IdCategoria, INSERTED.ImagenURL
            VALUES (@Titulo, @Autor, @FechaPublicacion, @IdCategoria, @ImagenURL);
        `;
        
        const result = await request.query(query);
        
        if (result.recordset && result.recordset.length > 0) {
            const nuevoLibro = result.recordset[0];
            if (nuevoLibro.IdCategoria) {
                const catResult = await pool.request()
                    .input('IdCategoria', sql.Int, nuevoLibro.IdCategoria)
                    .query('SELECT IdCategoria, Nombre FROM Categoria WHERE IdCategoria = @IdCategoria');
                if (catResult.recordset.length > 0) {
                    nuevoLibro.Categoria = catResult.recordset[0];
                }
            }
            res.status(201).json(nuevoLibro);
        } else {
            throw new Error('No se pudo crear el libro o recuperar sus datos.');
        }

    } catch (error) {
        console.error("Error creating libro:", error);
        res.status(500).json({ error: 'Error al crear el libro', details: error.message });
    }
});

// READ (Obtener todos) los libros
app.get('/api/libros', async (req, res) => {
    const { search } = req.query;
    try {
        const pool = await getPool();
        const request = pool.request();
        
        let query = `
            SELECT l.IdLibro, l.Titulo, l.Autor, l.FechaPublicacion, l.ImagenURL, l.IdCategoria, c.Nombre as CategoriaNombre
            FROM Libro l
            LEFT JOIN Categoria c ON l.IdCategoria = c.IdCategoria
        `;

        if (search) {
            query += ` WHERE l.Titulo LIKE @searchTerm OR l.Autor LIKE @searchTerm OR c.Nombre LIKE @searchTerm`;
            request.input('searchTerm', sql.VarChar, \`%\${search}%\`);
        }
        query += \` ORDER BY l.Titulo ASC\`;

        const result = await request.query(query);
        
        const librosConCategoria = result.recordset.map(libro => ({
            ...libro,
            Categoria: libro.IdCategoria ? { IdCategoria: libro.IdCategoria, Nombre: libro.CategoriaNombre } : null,
            CategoriaNombre: undefined 
        }));

        res.json(librosConCategoria);
    } catch (error) {
        console.error("Error fetching libros:", error);
        res.status(500).json({ error: 'Error al obtener los libros', details: error.message });
    }
});

// READ (Obtener un libro por ID)
app.get('/api/libros/:id', async (req, res) => {
    const { id } = req.params;
    try {
        const pool = await getPool();
        const request = pool.request();
        request.input('IdLibro', sql.Int, parseInt(id));

        const query = `
            SELECT l.IdLibro, l.Titulo, l.Autor, l.FechaPublicacion, l.ImagenURL, l.IdCategoria, c.Nombre as CategoriaNombre
            FROM Libro l
            LEFT JOIN Categoria c ON l.IdCategoria = c.IdCategoria
            WHERE l.IdLibro = @IdLibro;
        `;
        const result = await request.query(query);

        if (result.recordset.length > 0) {
            const libro = result.recordset[0];
            const libroConCategoria = {
                 ...libro,
                Categoria: libro.IdCategoria ? { IdCategoria: libro.IdCategoria, Nombre: libro.CategoriaNombre } : null,
                CategoriaNombre: undefined
            };
            res.json(libroConCategoria);
        } else {
            res.status(404).json({ error: 'Libro no encontrado' });
        }
    } catch (error) {
        console.error(\`Error fetching libro \${id}:\`, error);
        res.status(500).json({ error: 'Error al obtener el libro', details: error.message });
    }
});

// UPDATE (Actualizar) un libro existente
app.put('/api/libros/:id', async (req, res) => {
    const { id } = req.params;
    const { Titulo, Autor, FechaPublicacion, IdCategoria, ImagenURL } = req.body;
    try {
        const pool = await getPool();
        const request = pool.request();

        request.input('IdLibro', sql.Int, parseInt(id));
        request.input('Titulo', sql.VarChar, Titulo);
        request.input('Autor', sql.VarChar, Autor || null);
        request.input('FechaPublicacion', sql.Date, FechaPublicacion ? new Date(FechaPublicacion) : null);
        request.input('IdCategoria', sql.Int, IdCategoria ? parseInt(IdCategoria) : null);
        request.input('ImagenURL', sql.VarChar, ImagenURL || null);

        const query = `
            UPDATE Libro
            SET Titulo = @Titulo, Autor = @Autor, FechaPublicacion = @FechaPublicacion, 
                IdCategoria = @IdCategoria, ImagenURL = @ImagenURL
            OUTPUT INSERTED.IdLibro, INSERTED.Titulo, INSERTED.Autor, INSERTED.FechaPublicacion, INSERTED.IdCategoria, INSERTED.ImagenURL
            WHERE IdLibro = @IdLibro;
        `;
        const result = await request.query(query);

        if (result.recordset && result.recordset.length > 0) {
             let libroActualizado = result.recordset[0];
             if (libroActualizado.IdCategoria) {
                const catResult = await pool.request()
                    .input('IdCategoria', sql.Int, libroActualizado.IdCategoria)
                    .query('SELECT IdCategoria, Nombre FROM Categoria WHERE IdCategoria = @IdCategoria');
                if (catResult.recordset.length > 0) {
                    libroActualizado.Categoria = catResult.recordset[0];
                }
            }
            res.json(libroActualizado);
        } else {
            res.status(404).json({ error: 'Libro no encontrado para actualizar' });
        }
    } catch (error) {
        console.error(\`Error updating libro \${id}:\`, error);
        res.status(500).json({ error: 'Error al actualizar el libro', details: error.message });
    }
});

// DELETE (Borrar) un libro
app.delete('/api/libros/:id', async (req, res) => {
    const { id } = req.params;
    try {
        const pool = await getPool();
        const request = pool.request();
        request.input('IdLibro', sql.Int, parseInt(id));

        const result = await request.query('DELETE FROM Libro WHERE IdLibro = @IdLibro');
        
        if (result.rowsAffected[0] > 0) {
            res.status(204).send(); // No content
        } else {
            res.status(404).json({ error: 'Libro no encontrado para eliminar' });
        }
    } catch (error) {
        console.error(\`Error deleting libro \${id}:\`, error);
        res.status(500).json({ error: 'Error al eliminar el libro', details: error.message });
    }
});

// Inicializar conexi√≥n a la BD y luego iniciar el servidor
connectDB()
    .then(() => {
        app.listen(PORT, () => {
            console.log(\`üöÄ Servidor corriendo en http://localhost:\${PORT}\`);
        });
    })
    .catch(err => {
        console.error('‚ùå No se pudo iniciar el servidor debido a un error de base de datos:', err);
        process.exit(1); // Salir si no se puede conectar a la BD
    });
            </code></pre>
            <p class="highlight">Es <span class="highlight">crucial</span> que aqu√≠ incluyas el c√≥digo completo de <code>server.js</code> con todos los endpoints (CREATE, READ, UPDATE, DELETE) para libros y categor√≠as que ya hemos desarrollado.</p>

            <h3 id="paso2-5"><i class="fab fa-npm"></i> Paso 2.5: Scripts en <code>package.json</code></h3>
            <p>Aseg√∫rate de que tu <code>backend/package.json</code> tenga los scripts para iniciar el servidor:</p>
            <pre class="line-numbers"><code class="language-json">
{
  "name": "backend",
  "version": "1.0.0",
  "description": "",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "express": "^4.18.2",
    "mssql": "^10.0.0" 
  },
  "devDependencies": {
    "nodemon": "^3.0.1"
  }
}
            </code></pre>
        </section>

      <section id="parte3" class="manual-section">
        <h2><i class="fas fa-desktop"></i> Parte 3: Crear el Frontend</h2>
        <p>Construiremos la interfaz de usuario que interactuar√° con nuestra API.</p>

        <h3 id="paso3-1"><i class="fab fa-html5"></i> Paso 3.1: HTML Principal (<code>frontend/index.html</code>)</h3>
        <pre class="line-numbers"><code class="language-html">
&lt;!DOCTYPE html&gt;
&lt;html lang="es"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;üìö Gesti√≥n de Biblioteca&lt;/title&gt;
    &lt;!-- Bootstrap CSS --&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"&gt;
    &lt;!-- Font Awesome (iconos) --&gt;
    &lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"&gt;
    &lt;!-- Custom CSS --&gt;
    &lt;link rel="stylesheet" href="css/style.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm"&gt;
        &lt;div class="container"&gt;
            &lt;a class="navbar-brand" href="#" id="navBrandLink"&gt;&lt;i class="fas fa-book-open-reader"&gt;&lt;/i&gt; Mi Biblioteca Digital&lt;/a&gt;
            &lt;button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"&gt;
                &lt;span class="navbar-toggler-icon"&gt;&lt;/span&gt;
            &lt;/button&gt;
            &lt;div class="collapse navbar-collapse" id="navbarNav"&gt;
                &lt;ul class="navbar-nav ms-auto"&gt;
                    &lt;li class="nav-item"&gt;
                        &lt;a class="nav-link active" aria-current="page" href="#" id="navLibrosLink"&gt;&lt;i class="fas fa-book"&gt;&lt;/i&gt; Libros&lt;/a&gt;
                    &lt;/li&gt;
                    &lt;li class="nav-item"&gt;
                        &lt;a class="nav-link" href="#" id="navCategoriasLink"&gt;&lt;i class="fas fa-tags"&gt;&lt;/i&gt; Categor√≠as&lt;/a&gt;
                    &lt;/li&gt;
                &lt;/ul&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/nav&gt;

    &lt;div class="container mt-4"&gt;
        &lt;!-- Secci√≥n de Libros --&gt;
        &lt;section id="seccionLibros"&gt;
            &lt;div class="d-flex justify-content-between align-items-center mb-3"&gt;
                &lt;h2&gt;&lt;i class="fas fa-list-ul"&gt;&lt;/i&gt; Listado de Libros&lt;/h2&gt;
                &lt;button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#libroModal" id="btnNuevoLibro"&gt;
                    &lt;i class="fas fa-plus-circle"&gt;&lt;/i&gt; A√±adir Libro üÜï
                &lt;/button&gt;
            &lt;/div&gt;

            &lt;div class="row mb-3"&gt;
                &lt;div class="col-md-6 offset-md-6"&gt;
                    &lt;div class="input-group"&gt;
                        &lt;input type="text" class="form-control" id="searchInput" placeholder="Buscar por t√≠tulo, autor o categor√≠a..."&gt;
                        &lt;button class="btn btn-outline-secondary" type="button" id="btnBuscar"&gt;&lt;i class="fas fa-search"&gt;&lt;/i&gt; Buscar&lt;/button&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;div id="librosContainer" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4"&gt;
                &lt;!-- Las tarjetas de libros se insertar√°n aqu√≠ --&gt;
            &lt;/div&gt;
            &lt;p id="noResultsLibros" class="text-center fs-4 mt-5" style="display: none;"&gt;ü§∑‚Äç‚ôÇÔ∏è No se encontraron libros que coincidan con tu b√∫squeda.&lt;/p&gt;
        &lt;/section&gt;

        &lt;!-- Secci√≥n de Categor√≠as --&gt;
        &lt;section id="seccionCategorias" style="display: none;"&gt;
            &lt;div class="d-flex justify-content-between align-items-center mb-3"&gt;
                &lt;h2&gt;&lt;i class="fas fa-tags"&gt;&lt;/i&gt; Listado de Categor√≠as&lt;/h2&gt;
            &lt;/div&gt;
            &lt;div id="categoriasContainer" class="list-group"&gt;
                &lt;!-- Las categor√≠as se listar√°n aqu√≠ --&gt;
            &lt;/div&gt;
            &lt;p id="noResultsCategorias" class="text-center fs-4 mt-5" style="display: none;"&gt;ü§∑‚Äç‚ôÄÔ∏è No se encontraron categor√≠as.&lt;/p&gt;
        &lt;/section&gt;
    &lt;/div&gt;

    &lt;!-- Modal para A√±adir/Editar Libro --&gt;
    &lt;div class="modal fade" id="libroModal" tabindex="-1" aria-labelledby="libroModalLabel" aria-hidden="true"&gt;
        &lt;div class="modal-dialog modal-lg"&gt;
            &lt;div class="modal-content"&gt;
                &lt;div class="modal-header bg-primary text-white"&gt;
                    &lt;h5 class="modal-title" id="libroModalLabel"&gt;&lt;i class="fas fa-book"&gt;&lt;/i&gt; Gestionar Libro&lt;/h5&gt;
                    &lt;button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"&gt;&lt;/button&gt;
                &lt;/div&gt;
                &lt;div class="modal-body"&gt;
                    &lt;form id="libroForm"&gt;
                        &lt;input type="hidden" id="libroId"&gt;
                        &lt;div class="mb-3"&gt;
                            &lt;label for="titulo" class="form-label"&gt;T√≠tulo &lt;span class="text-danger"&gt;*&lt;/span&gt;&lt;/label&gt;
                            &lt;input type="text" class="form-control" id="titulo" required&gt;
                        &lt;/div&gt;
                        &lt;div class="mb-3"&gt;
                            &lt;label for="autor" class="form-label"&gt;Autor&lt;/label&gt;
                            &lt;input type="text" class="form-control" id="autor"&gt;
                        &lt;/div&gt;
                        &lt;div class="row"&gt;
                            &lt;div class="col-md-6 mb-3"&gt;
                                &lt;label for="fechaPublicacion" class="form-label"&gt;Fecha de Publicaci√≥n&lt;/label&gt;
                                &lt;input type="date" class="form-control" id="fechaPublicacion"&gt;
                            &lt;/div&gt;
                            &lt;div class="col-md-6 mb-3"&gt;
                                &lt;label for="categoria" class="form-label"&gt;Categor√≠a&lt;/label&gt;
                                &lt;select class="form-select" id="categoria"&gt;
                                    &lt;option value=""&gt;Seleccionar categor√≠a...&lt;/option&gt;
                                &lt;/select&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                        &lt;div class="mb-3"&gt;
                            &lt;label for="imagenURL" class="form-label"&gt;URL de la Imagen&lt;/label&gt;
                            &lt;input type="url" class="form-control" id="imagenURL" placeholder="https://ejemplo.com/imagen.jpg"&gt;
                        &lt;/div&gt;
                    &lt;/form&gt;
                &lt;/div&gt;
                &lt;div class="modal-footer"&gt;
                    &lt;button type="button" class="btn btn-secondary" data-bs-dismiss="modal"&gt;&lt;i class="fas fa-times-circle"&gt;&lt;/i&gt; Cancelar&lt;/button&gt;
                    &lt;button type="submit" form="libroForm" class="btn btn-primary"&gt;&lt;i class="fas fa-save"&gt;&lt;/i&gt; Guardar Cambios&lt;/button&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;!-- Scripts JS --&gt;
    &lt;!-- Bootstrap JS Bundle --&gt;
    &lt;script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"&gt;&lt;/script&gt;
    &lt;!-- Prism.js (Core + Autoloader + Line Numbers) --&gt;
    &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"&gt;&lt;/script&gt;
    &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"&gt;&lt;/script&gt;
    &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"&gt;&lt;/script&gt;
    &lt;!-- Chart.js --&gt;
    &lt;script src="https://cdn.jsdelivr.net/npm/chart.js"&gt;&lt;/script&gt;
    &lt;!-- Marked.js --&gt;
    &lt;script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"&gt;&lt;/script&gt;
    &lt;!-- Lucide Icons --&gt;
    &lt;script src="https://cdn.jsdelivr.net/npm/lucide-static@latest/dist/lucide.min.js"&gt;&lt;/script&gt;
    &lt;!-- Custom JS --&gt;
    &lt;script src="js/main.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
        </code></pre>
        <p class="note"><i class="fas fa-file-code"></i> Copia el contenido completo del <code>index.html</code> que te proporcion√© anteriormente.</p>
    </section>


    <h3 id="paso3-2"><i class="fab fa-css3-alt"></i> Paso 3.2: CSS (<code>frontend/css/style.css</code>)</h3>
    <pre class="line-numbers"><code class="language-css">
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f8f9fa;
}

.navbar-brand {
    font-weight: bold;
}

.card {
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    border: none;
    border-radius: 0.75rem;
    overflow: hidden; /* Para que la imagen no se salga del borde redondeado */
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.15);
}

.card-img-top {
    width: 100%;
    height: 250px; /* Altura fija para las im√°genes */
    object-fit: cover; /* Escala la imagen manteniendo la relaci√≥n de aspecto y rellenando el espacio */
    border-bottom: 1px solid #eee;
}

.card-title {
    font-weight: 600;
    color: #333;
}

.card-text small {
    color: #6c757d;
}

.badge {
    font-size: 0.8em;
}

.btn-action {
    margin-right: 5px;
}

.modal-header {
    border-bottom: none;
}

.modal-footer {
    border-top: none;
}

/* Estilo para placeholders de im√°genes si no cargan */
.card-img-top[src=""],
.card-img-top:not([src]) {
    background-color: #e9ecef;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #6c757d;
    font-size: 1.5rem;
}
.card-img-top[src=""]:after,
.card-img-top:not([src]):after {
    content: "üñºÔ∏è"; /* O un icono de imagen de Font Awesome */
}
    </code></pre>
    <p class="note"><i class="fas fa-palette"></i> Copia el contenido completo del <code>style.css</code> que te proporcion√©.</p>

    <h3 id="paso3-3"><i class="fab fa-js-square"></i> Paso 3.3: JavaScript Principal (<code>frontend/js/main.js</code>)</h3>
    <pre class="line-numbers"><code class="language-javascript">
document.addEventListener('DOMContentLoaded', () => {
    const API_URL = 'http://localhost:3000/api';
    
    // Elementos comunes
    const libroModal = new bootstrap.Modal(document.getElementById('libroModal'));
    const libroModalLabel = document.getElementById('libroModalLabel');
    const libroForm = document.getElementById('libroForm');
    const categoriaSelectLibroForm = document.getElementById('categoria'); // Selector de categor√≠a en el modal de libro

    // Elementos para la secci√≥n de Libros
    const seccionLibros = document.getElementById('seccionLibros');
    const librosContainer = document.getElementById('librosContainer');
    const btnNuevoLibro = document.getElementById('btnNuevoLibro');
    const searchInput = document.getElementById('searchInput');
    const btnBuscar = document.getElementById('btnBuscar');
    const noResultsLibrosP = document.getElementById('noResultsLibros');

    // Elementos para la secci√≥n de Categor√≠as
    const seccionCategorias = document.getElementById('seccionCategorias');
    const categoriasContainer = document.getElementById('categoriasContainer');
    const noResultsCategoriasP = document.getElementById('noResultsCategorias');

    // Enlaces de navegaci√≥n
    const navBrandLink = document.getElementById('navBrandLink');
    const navLibrosLink = document.getElementById('navLibrosLink');
    const navCategoriasLink = document.getElementById('navCategoriasLink');
    const navLinks = document.querySelectorAll('.navbar-nav .nav-link'); // Todos los links del nav

    let editMode = false;
    let libroAEditarId = null;

    // --- NAVEGACI√ìN ENTRE SECCIONES ---
    const mostrarSeccion = (idSeccionAMostrar) => {
        [seccionLibros, seccionCategorias].forEach(seccion => {
            seccion.style.display = seccion.id === idSeccionAMostrar ? 'block' : 'none';
        });

        // Actualizar clase 'active' en navbar
        navLinks.forEach(link => link.classList.remove('active'));
        if (idSeccionAMostrar === 'seccionLibros') {
            navLibrosLink.classList.add('active');
        } else if (idSeccionAMostrar === 'seccionCategorias') {
            navCategoriasLink.classList.add('active');
        }
    };

    navBrandLink.addEventListener('click', (e) => {
        e.preventDefault();
        mostrarSeccion('seccionLibros');
        cargarLibros(); // Recargar libros por si acaso
    });

    navLibrosLink.addEventListener('click', (e) => {
        e.preventDefault();
        mostrarSeccion('seccionLibros');
        // Opcional: recargar libros si es necesario o si la vista no se actualiza autom√°ticamente
        // cargarLibros(searchInput.value.trim()); 
    });

    navCategoriasLink.addEventListener('click', (e) => {
        e.preventDefault();
        mostrarSeccion('seccionCategorias');
        cargarYRenderizarCategoriasEnLista(); // Cargar y mostrar categor√≠as
    });


    // --- FUNCIONES PARA CATEGOR√çAS ---
    // Cargar categor√≠as para el selector en el formulario de libros
    const cargarCategoriasParaFormulario = async () => {
        try {
            const response = await fetch(\`\${API_URL}/categorias\`);
            if (!response.ok) throw new Error('Error al cargar categor√≠as para el formulario');
            const categorias = await response.json();
            
            categoriaSelectLibroForm.innerHTML = '&lt;option value=""&gt;Seleccionar categor√≠a...&lt;/option&gt;'; // Reset
            categorias.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.IdCategoria;
                option.textContent = cat.Nombre;
                categoriaSelectLibroForm.appendChild(option);
            });
        } catch (error) {
            console.error('Error cargando categor√≠as para formulario:', error);
            // Considerar mostrar un mensaje al usuario si esto falla
        }
    };

    // Cargar y renderizar categor√≠as en la secci√≥n de categor√≠as
    const cargarYRenderizarCategoriasEnLista = async () => {
        try {
            const response = await fetch(\`\${API_URL}/categorias\`);
            if (!response.ok) throw new Error('Error al cargar la lista de categor√≠as');
            const categorias = await response.json();
            renderCategoriasEnLista(categorias);
        } catch (error) {
            console.error('Error cargando lista de categor√≠as:', error);
            categoriasContainer.innerHTML = \`<p class="text-danger text-center">Error al cargar las categor√≠as. \${error.message}</p>\`;
            noResultsCategoriasP.style.display = 'none';
        }
    };

    const renderCategoriasEnLista = (categorias) => {
        categoriasContainer.innerHTML = ''; // Limpiar
        if (categorias.length === 0) {
            noResultsCategoriasP.style.display = 'block';
            return;
        }
        noResultsCategoriasP.style.display = 'none';

        categorias.forEach(cat => {
            const categoriaItem = \`
                &lt;a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"&gt;
                    \${cat.Nombre}
                    &lt;span class="badge bg-primary rounded-pill"&gt;\${/* Podr√≠as contar libros por categor√≠a aqu√≠ en el futuro */}</span>
                    &lt;!-- Podr√≠as a√±adir botones de Editar/Eliminar categor√≠a aqu√≠ en el futuro --&gt;
                &lt;/a&gt;
            \`;
            categoriasContainer.insertAdjacentHTML('beforeend', categoriaItem);
        });
    };


    // --- FUNCIONES PARA LIBROS (existentes, algunas peque√±as adaptaciones) ---
    const formatDateForInput = (dateString) => {
        if (!dateString) return '';
        const date = new Date(dateString);
        return date.toISOString().split('T')[0];
    };
    
    const formatDateForDisplay = (dateString) => {
        if (!dateString) return 'N/A';
        const date = new Date(dateString);
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        return \`\${day}/\${month}/\${year}\`;
    };

    const cargarLibros = async (searchTerm = '') => {
        try {
            const url = searchTerm ? \`\${API_URL}/libros?search=\${encodeURIComponent(searchTerm)}\` : \`\${API_URL}/libros\`;
            const response = await fetch(url);
            if (!response.ok) throw new Error('Error al cargar libros');
            const libros = await response.json();
            renderLibros(libros);
        } catch (error) {
            console.error('Error cargando libros:', error);
            librosContainer.innerHTML = \`<p class="text-danger text-center">Error al cargar los libros. \${error.message}</p>\`;
            noResultsLibrosP.style.display = 'none';
        }
    };

    const renderLibros = (libros) => {
        librosContainer.innerHTML = '';
        if (libros.length === 0 && searchInput.value.trim() !== '') { // Mostrar solo si hay b√∫squeda y no hay resultados
            noResultsLibrosP.style.display = 'block';
        } else if (libros.length === 0 && searchInput.value.trim() === '') { // Si no hay b√∫squeda y no hay libros en BD
            noResultsLibrosP.textContent = "üìö A√∫n no hay libros en la biblioteca. ¬°A√±ade algunos!";
            noResultsLibrosP.style.display = 'block';
        } else {
            noResultsLibrosP.style.display = 'none';
            noResultsLibrosP.textContent = "ü§∑‚Äç‚ôÇÔ∏è No se encontraron libros que coincidan con tu b√∫squeda."; // Reset al texto original
        }


        libros.forEach(libro => {
            const categoriaNombre = libro.Categoria ? libro.Categoria.Nombre : 'Sin categor√≠a';
            const card = \`
                &lt;div class="col"&gt;
                    &lt;div class="card h-100 shadow-sm"&gt;
                        &lt;img src="\${libro.ImagenURL || 'https://via.placeholder.com/300x200.png?text=Sin+Imagen'}" 
                             class="card-img-top" alt="\${libro.Titulo}" 
                             onerror="this.onerror=null;this.src='https://via.placeholder.com/300x200.png?text=Error+Imagen';"&gt;
                        &lt;div class="card-body"&gt;
                            &lt;h5 class="card-title"&gt;\${libro.Titulo}&lt;/h5&gt;
                            &lt;p class="card-text"&gt;&lt;small class="text-muted"&gt;&lt;strong&gt;Autor:&lt;/strong&gt; \${libro.Autor || 'N/A'}&lt;/small&gt;&lt;/p&gt;
                            &lt;p class="card-text"&gt;&lt;small class="text-muted"&gt;&lt;strong&gt;Publicado:&lt;/strong&gt; \${formatDateForDisplay(libro.FechaPublicacion)}&lt;/small&gt;&lt;/p&gt;
                            &lt;p class="card-text"&gt;
                                &lt;span class="badge bg-info text-dark"&gt;\${categoriaNombre}&lt;/span&gt;
                            &lt;/p&gt;
                        &lt;/div&gt;
                        &lt;div class="card-footer bg-transparent border-top-0 d-flex justify-content-end"&gt;
                            &lt;button class="btn btn-sm btn-outline-primary btn-action btn-edit" data-id="\${libro.IdLibro}" title="Editar"&gt;
                                &lt;i class="fas fa-edit"&gt;&lt;/i&gt; Editar
                            &lt;/button&gt;
                            &lt;button class="btn btn-sm btn-outline-danger btn-action btn-delete" data-id="\${libro.IdLibro}" title="Eliminar"&gt;
                                &lt;i class="fas fa-trash-alt"&gt;&lt;/i&gt; Eliminar
                            &lt;/button&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            \`;
            librosContainer.insertAdjacentHTML('beforeend', card);
        });

        document.querySelectorAll('.btn-edit').forEach(btn => {
            btn.addEventListener('click', handleEdit);
        });
        document.querySelectorAll('.btn-delete').forEach(btn => {
            btn.addEventListener('click', handleDelete);
        });
    };

    libroForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const libroData = {
            Titulo: document.getElementById('titulo').value,
            Autor: document.getElementById('autor').value,
            FechaPublicacion: document.getElementById('fechaPublicacion').value || null,
            IdCategoria: document.getElementById('categoria').value ? parseInt(document.getElementById('categoria').value) : null,
            ImagenURL: document.getElementById('imagenURL').value
        };

        try {
            let response;
            const method = (editMode && libroAEditarId) ? 'PUT' : 'POST';
            const url = (editMode && libroAEditarId) ? \`\${API_URL}/libros/\${libroAEditarId}\` : \`\${API_URL}/libros\`;

            response = await fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(libroData)
            });
            
            if (!response.ok) {
                const errorData = await response.json().catch(() => ({error: "Error desconocido"}));
                throw new Error(errorData.error || \`Error al \${editMode ? 'actualizar' : 'guardar'} el libro.\`);
            }
            
            libroModal.hide();
            cargarLibros(searchInput.value.trim());
            alert(\`Libro \${editMode ? 'actualizado' : 'guardado'} exitosamente! üéâ\`);

        } catch (error) {
            console.error('Error guardando/actualizando libro:', error);
            alert(\`Error: \${error.message}\`);
        }
    });

    btnNuevoLibro.addEventListener('click', () => {
        editMode = false;
        libroAEditarId = null;
        libroForm.reset();
        document.getElementById('libroId').value = '';
        libroModalLabel.innerHTML = '&lt;i class="fas fa-book-medical"&gt;&lt;/i&gt; A√±adir Nuevo Libro';
        cargarCategoriasParaFormulario().then(() => {
             libroModal.show();
        });
    });

    const handleEdit = async (e) => {
        editMode = true;
        libroAEditarId = e.target.closest('.btn-edit').dataset.id;
        
        try {
            const response = await fetch(\`\${API_URL}/libros/\${libroAEditarId}\`);
            if (!response.ok) throw new Error('Libro no encontrado o error al cargar.');
            const libro = await response.json();

            await cargarCategoriasParaFormulario(); 
            
            document.getElementById('libroId').value = libro.IdLibro;
            document.getElementById('titulo').value = libro.Titulo;
            document.getElementById('autor').value = libro.Autor || '';
            document.getElementById('fechaPublicacion').value = formatDateForInput(libro.FechaPublicacion);
            document.getElementById('categoria').value = libro.IdCategoria || '';
            document.getElementById('imagenURL').value = libro.ImagenURL || '';
            
            libroModalLabel.innerHTML = '&lt;i class="fas fa-edit"&gt;&lt;/i&gt; Editar Libro';
            libroModal.show();
        } catch (error) {
            console.error('Error preparando edici√≥n:', error);
            alert(\`Error al cargar datos del libro: \${error.message}\`);
        }
    };

    const handleDelete = async (e) => {
        const id = e.target.closest('.btn-delete').dataset.id;
        if (confirm('¬øEst√°s seguro de que quieres eliminar este libro? üóëÔ∏è')) {
            try {
                const response = await fetch(\`\${API_URL}/libros/\${id}\`, { method: 'DELETE' });
                if (!response.ok && response.status !== 204) { 
                     const errorData = await response.json().catch(() => ({error: "Error desconocido al eliminar"}));
                     throw new Error(errorData.error || \`Error al eliminar el libro. Estado: \${response.status}\`);
                }
                cargarLibros(searchInput.value.trim());
                alert('Libro eliminado exitosamente! üöÆ');
            } catch (error) {
                console.error('Error eliminando libro:', error);
                alert(\`Error al eliminar el libro: \${error.message}\`);
            }
        }
    };

    const performSearch = () => {
        const searchTerm = searchInput.value.trim();
        cargarLibros(searchTerm);
    };

    btnBuscar.addEventListener('click', performSearch);
    searchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            performSearch();
        }
    });
    
    document.getElementById('libroModal').addEventListener('hidden.bs.modal', () => {
        libroForm.reset();
        editMode = false;
        libroAEditarId = null;
        document.getElementById('libroId').value = '';
    });

    // --- CARGA INICIAL ---
    mostrarSeccion('seccionLibros'); 
    cargarCategoriasParaFormulario(); 
    cargarLibros(); 
});       
    </code></pre>
    <p class="note"><i class="fas fa-cogs"></i> Copia el contenido completo del <code>main.js</code> que te proporcion√©.</p>
</section>

        <section id="parte4" class="manual-section">
            <h2><i class="fas fa-play-circle"></i> Parte 4: Ejecutar y Probar la Aplicaci√≥n</h2>
            
            <h3>Paso 4.1: Ejecutar el Backend</h3>
            <p>En la terminal, dentro de la carpeta <code>backend</code>:</p>
            <pre class="line-numbers"><code class="language-bash">
npm run dev
            </code></pre>
<p>o este comando</p>

            <pre class="line-numbers"><code class="language-bash">
npm start
            </code></pre>

            <p>Verifica la salida de la consola para confirmar la conexi√≥n a la BD y que el servidor est√© corriendo en <code>http://localhost:3000</code>.</p>

            <h3>Paso 4.2: Ver el Frontend</h3>
            <p>Abre el archivo <code>frontend/index.html</code> en tu navegador web (haciendo doble clic o usando una extensi√≥n como "Live Server" en VS Code).</p>
            <p>¬°Prueba todas las funcionalidades del CRUD y la navegaci√≥n entre secciones! ü•≥</p>
            <p class="highlight">Recuerda revisar la consola del desarrollador (F12) en tu navegador y la consola del backend para cualquier error durante las pruebas.</p>
     
     <br>
     <br>
    <div class="d-flex justify-content-center">
    <img src="img/Screenshot_425.png" alt="Descripci√≥n de la imagen" class="img-fluid" style="width: 90%;">
</div>
     
     
        </section>



        <section id="conclusion" class="manual-section">
            <h2><i class="fas fa-check-circle"></i> Conclusi√≥n y Pr√≥ximos Pasos ‚úÖ</h2>
            <p>¬°Felicidades! Has construido una aplicaci√≥n Full-Stack funcional para gestionar una biblioteca. Has trabajado con Node.js, Express, SQL Server, y JavaScript vainilla para el frontend, lo que te proporciona una base s√≥lida.</p>
            <p><strong>Posibles Pr√≥ximos Pasos:</strong></p>
            <ul>
                <li>Implementar un CRUD completo para las Categor√≠as.</li>
                <li>A√±adir validaciones m√°s robustas en el backend y frontend.</li>
                <li>Mejorar el manejo de errores y la retroalimentaci√≥n al usuario.</li>
                <li>Implementar paginaci√≥n para la lista de libros si crece mucho.</li>
                <li>Considerar la autenticaci√≥n y autorizaci√≥n de usuarios.</li>
                <li>Explorar el despliegue de la aplicaci√≥n en un servidor.</li>
                <li>Refactorizar el c√≥digo y organizarlo en m√≥dulos m√°s peque√±os.</li>
            </ul>
            <p>Sigue practicando y construyendo. ¬°El desarrollo web es un viaje de aprendizaje continuo! üåü</p>
        </section>

               <footer class="main-footer">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                        <p class="mb-0">¬© 2024 Manual del Proyecto Biblioteca. Creado con <i class="fas fa-heart text-danger"></i>.</p>
                        <p class="mb-0  ">Desarrollado por Ing. Juancito Pe√±a</p>
                    </div>
                    <div class="col-md-6 text-center text-md-end">
                        <p class="mb-1">S√≠guenos en nuestras redes:</p>
                        <a href="https://www.linkedin.com/in/juancitope%C3%B1a/" target="_blank" rel="noopener noreferrer" class="social-icon" title="LinkedIn">
                            <i class="fab fa-linkedin fa-2x"></i>
                        </a>
                        <a href="https://www.youtube.com/channel/UCSob-3E5z4IHtMF5B4bN-FA" target="_blank" rel="noopener noreferrer" class="social-icon" title="YouTube">
                            <i class="fab fa-youtube fa-2x"></i>
                        </a>
                        <a href="https://github.com/JUANCITOPENA" target="_blank" rel="noopener noreferrer" class="social-icon" title="GitHub">
                            <i class="fab fa-github fa-2x"></i>
                        </a>
                        <!-- Puedes a√±adir m√°s iconos aqu√≠ -->
                        <!-- Ejemplo Twitter/X -->
                        <!--
                        <a href="https://twitter.com/tu-usuario-twitter" target="_blank" rel="noopener noreferrer" class="social-icon" title="Twitter/X">
                            <i class="fab fa-twitter fa-2x"></i>
                        </a>
                        -->
                    </div>
                </div>
            </div>
        </footer>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide-static@latest/dist/lucide.min.js"></script>
    </body>
</html>
